!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("ramda"),require("route-parser"),require("@notabug/gun-suppressor")):"function"==typeof define&&define.amd?define("@notabug/gun-suppressor-sear",["ramda","route-parser","@notabug/gun-suppressor"],r):"object"==typeof exports?exports["@notabug/gun-suppressor-sear"]=r(require("ramda"),require("route-parser"),require("@notabug/gun-suppressor")):e["@notabug/gun-suppressor-sear"]=r(e.ramda,e["route-parser"],e["@notabug/gun-suppressor"])}("undefined"!=typeof self?self:this,function(e,r,t){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r,t){"use strict";(function(e){Object.defineProperty(r,"__esModule",{value:!0}),r.initAjv=r.read=r.PERMISSIVE_SCHEMA=r.PERMISSIVE_NODE_SCHEMA=r.AUTH_SCHEMA=void 0;var n,o=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(2)),i=(n=t(3))&&n.__esModule?n:{default:n},a=t(4);var u=new i.default("~:authorId"),s=new i.default("*stuff~:authorId."),p={seaAlias:{type:"string",maxLength:512},SEAAlias:{title:"Gun SEA Alias",$async:!0,soul:{pattern:"~@:alias",properties:{alias:{$ref:"schema.json#/definitions/seaAlias"}},required:["alias"]},additionalProperties:{edgeMatchesKey:!0,anyOf:[{$ref:"#/definitions/SEAAuthorEdge"}]}},seaAuthorId:{type:"string",maxLength:128},seaAuthObj:{oneOf:[{type:"object",properties:{ek:{type:"string"},s:{type:"string"}}},{type:"string"}]},SEAAuthor:{title:"Gun SEA Author",$async:!0,properties:{pub:{$ref:"#/definitions/seaAuthorId"},epub:{sea:{type:"string"}},alias:{sea:{$ref:"schema.json#/definitions/seaAlias"}},auth:{sea:{$ref:"schema.json#/definitions/seaAuthObj"}}},additionalProperties:{sea:{anyOf:[{$ref:"schema.json#/definitions/GunEdge"},{$ref:"schema.json#/definitions/seaAuthObj"},{type:"null"},{type:"string"},{type:"number"},{type:"boolean"}]}},soul:{pattern:"~:authorId",properties:{authorId:{$ref:"schema.json#/definitions/seaAuthorId"}},required:["authorId"]}}};r.AUTH_SCHEMA=p;var f={title:"Gun SEA Node",description:"Any SEA node supported by gun",$async:!0,soul:{pattern:"*path~:authorId.",properties:{path:{type:"string"},authorId:{$ref:"schema.json#/definitions/seaAuthorId"}},required:["path","authorId"]},additionalProperties:{".*":{sea:{anyOf:[{$ref:"schema.json#/definitions/GunNodeMeta"},{$ref:"schema.json#/definitions/GunEdge"},{type:"null"},{type:"string"},{type:"number"},{type:"boolean"}]}}}};r.PERMISSIVE_NODE_SCHEMA=f;var d={...p,SEANode:f,...a.PERMISSIVE_SCHEMA};r.PERMISSIVE_SCHEMA=d;var c=function(e,r,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.SEA.opt.pack(r[t],t,r,o.path(["_","#"],r));return e.SEA.verify(i,n).then(function(n){if(void 0===n)throw new Error("invalid sea data");return e.SEA.opt.unpack(n,t,r)})};r.read=c;var l=function(e,r){return function(t,n,i,a,p,f){var d=o.path(["_","#"],p);if("_"===f)return!0;var l=(s.match(d)||u.match(d)||{}).authorId;if(!l)return!1;if(d==="~".concat(l)&&"pub"===f)return n===l;var y,h,b,g,A=r.compile({additionalProperties:!0,properties:(y={},h=f,b=t,h in y?Object.defineProperty(y,h,{value:b,enumerable:!0,configurable:!0,writable:!0}):y[h]=b,y)});return c(e,p,f,l).then(function(e){return g=e}).then(function(e){return o.assoc(f,e,p)}).catch(function(e){return console.error("key err",d,f,l,p[f],e.stack||e),!1}).then(function(e){return e&&void 0!==e[f]?Promise.resolve(A(e)).then(function(e){return e||console.error("sea validation err",d,f,g,A.errors,i),e}):(delete p[f],delete(o.path(["_",">"],p)||{})[f],console.error("sea prop err",d,f,g,i),e)})}};r.initAjv=function(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Gun;return o.compose(function(e){return e.addKeyword("sea",{async:!0,modifying:!0,validate:l(t,e)}),e},a.initAjv)(r)}}).call(this,t(1))},function(e,r){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(e){"object"==typeof window&&(t=window)}e.exports=t},function(r,t){r.exports=e},function(e,t){e.exports=r},function(e,r){e.exports=t}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Abm90YWJ1Zy9ndW4tc3VwcHJlc3Nvci1zZWFyL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9Abm90YWJ1Zy9ndW4tc3VwcHJlc3Nvci1zZWFyL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0Bub3RhYnVnL2d1bi1zdXBwcmVzc29yLXNlYXIvLi9zcmMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vQG5vdGFidWcvZ3VuLXN1cHByZXNzb3Itc2Vhci8od2VicGFjaykvYnVpbGRpbi9nbG9iYWwuanMiLCJ3ZWJwYWNrOi8vQG5vdGFidWcvZ3VuLXN1cHByZXNzb3Itc2Vhci9leHRlcm5hbCBcInJhbWRhXCIiLCJ3ZWJwYWNrOi8vQG5vdGFidWcvZ3VuLXN1cHByZXNzb3Itc2Vhci9leHRlcm5hbCBcInJvdXRlLXBhcnNlclwiIiwid2VicGFjazovL0Bub3RhYnVnL2d1bi1zdXBwcmVzc29yLXNlYXIvZXh0ZXJuYWwgXCJAbm90YWJ1Zy9ndW4tc3VwcHJlc3NvclwiIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsInJlcXVpcmUiLCJkZWZpbmUiLCJhbWQiLCJzZWxmIiwidGhpcyIsIl9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzJfXyIsIl9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzNfXyIsIl9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzRfXyIsImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsInQiLCJtb2RlIiwiX19lc01vZHVsZSIsIm5zIiwiY3JlYXRlIiwia2V5IiwiYmluZCIsIm4iLCJvYmplY3QiLCJwcm9wZXJ0eSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwicCIsInMiLCJSIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfcm91dGVQYXJzZXIiLCJfZ3VuU3VwcHJlc3NvciIsInNlYUF1dGhvclJvdXRlIiwiZGVmYXVsdCIsInNlYVNvdWxSb3V0ZSIsIkFVVEhfU0NIRU1BIiwic2VhQWxpYXMiLCJ0eXBlIiwibWF4TGVuZ3RoIiwiU0VBQWxpYXMiLCJ0aXRsZSIsIiRhc3luYyIsInNvdWwiLCJwYXR0ZXJuIiwicHJvcGVydGllcyIsImFsaWFzIiwiJHJlZiIsInJlcXVpcmVkIiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJlZGdlTWF0Y2hlc0tleSIsImFueU9mIiwic2VhQXV0aG9ySWQiLCJzZWFBdXRoT2JqIiwib25lT2YiLCJlayIsIlNFQUF1dGhvciIsInB1YiIsImVwdWIiLCJzZWEiLCJhdXRoIiwiYXV0aG9ySWQiLCJQRVJNSVNTSVZFX05PREVfU0NIRU1BIiwiZGVzY3JpcHRpb24iLCJwYXRoIiwiLioiLCJQRVJNSVNTSVZFX1NDSEVNQSIsIlNFQU5vZGUiLCJyZWFkIiwiR3VuIiwiZGF0YSIsInBhaXIiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJwYWNrZWQiLCJTRUEiLCJvcHQiLCJwYWNrIiwidmVyaWZ5IiwidGhlbiIsIkVycm9yIiwidW5wYWNrIiwidmFsaWRhdGVTZWFQcm9wZXJ0eSIsImFqdiIsInNjaGVtYSIsInBTY2hlbWEiLCJfY1BhdGgiLCJwYXJlbnREYXRhIiwia2V5SW5QYXJlbnQiLCJtYXRjaCIsImNvbmNhdCIsInJlc3VsdCIsInZhbGlkYXRlIiwiY29tcGlsZSIsInJlcyIsImFzc29jIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGFjayIsIlByb21pc2UiLCJyZXNvbHZlIiwiaXNWYWxpZCIsImVycm9ycyIsImNvbmYiLCJnbG9iYWwiLCJjb21wb3NlIiwiYWRkS2V5d29yZCIsImFzeW5jIiwibW9kaWZ5aW5nIiwiaW5pdEFqdiIsImciLCJGdW5jdGlvbiIsImUiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsaUJBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELEVBQUFHLFFBQUEsU0FBQUEsUUFBQSxnQkFBQUEsUUFBQSw0QkFDQSxtQkFBQUMsZUFBQUMsSUFDQUQsT0FBQSxrRkFBQUosR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxnQ0FBQUQsRUFBQUcsUUFBQSxTQUFBQSxRQUFBLGdCQUFBQSxRQUFBLDRCQUVBSixFQUFBLGdDQUFBQyxFQUFBRCxFQUFBLE1BQUFBLEVBQUEsZ0JBQUFBLEVBQUEsNEJBUkEsQ0FTQyxvQkFBQU8sVUFBQUMsS0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVosUUFHQSxJQUFBQyxFQUFBUyxFQUFBRSxHQUFBLENBQ0FDLEVBQUFELEVBQ0FFLEdBQUEsRUFDQWQsUUFBQSxJQVVBLE9BTkFlLEVBQUFILEdBQUFJLEtBQUFmLEVBQUFELFFBQUFDLElBQUFELFFBQUFXLEdBR0FWLEVBQUFhLEdBQUEsRUFHQWIsRUFBQUQsUUEwREEsT0FyREFXLEVBQUFNLEVBQUFGLEVBR0FKLEVBQUFPLEVBQUFSLEVBR0FDLEVBQUFRLEVBQUEsU0FBQW5CLEVBQUFvQixFQUFBQyxHQUNBVixFQUFBVyxFQUFBdEIsRUFBQW9CLElBQ0FHLE9BQUFDLGVBQUF4QixFQUFBb0IsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1YsRUFBQWdCLEVBQUEsU0FBQTNCLEdBQ0Esb0JBQUE0QixlQUFBQyxhQUNBTixPQUFBQyxlQUFBeEIsRUFBQTRCLE9BQUFDLFlBQUEsQ0FBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUF4QixFQUFBLGNBQWlEOEIsT0FBQSxLQVFqRG5CLEVBQUFv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UkFDLFFBQVFDLE1BQ04sVUFDQXpELEVBQ0E4QyxFQUNBNUIsRUFDQTJCLEVBQVdDLEdBQ1hTLEVBQUlHLE9BQVNILElBRVIsSUFFUmxCLEtBQUssU0FBQWUsR0FDSixPQUFLQSxRQUFtQyxJQUFyQkEsRUFBSU4sR0FNaEJhLFFBQVFDLFFBQVFWLEVBQVNFLElBQU1mLEtBQUssU0FBQXdCLEdBV3pDLE9BVktBLEdBQ0hMLFFBQVFDLE1BQ04scUJBQ0F6RCxFQUNBOEMsRUFDQUcsRUFDQUMsRUFBU1ksT0FDVG5CLEdBR0drQixZQWhCQWhCLEVBQVdDLFVBQ1Y1RCxFQUFFbUMsS0FBSyxDQUFDLElBQUssS0FBTXdCLElBQWUsSUFBSUMsR0FDOUNVLFFBQVFDLE1BQU0sZUFBZ0J6RCxFQUFNOEMsRUFBYUcsRUFBUU4sR0FDbERTLGlCQWtCUSxTQUFDVyxHQUFELElBQU9yQyxFQUFQRyxVQUFBQyxPQUFBLFFBQUFDLElBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFhbUMsRUFBT3RDLElBQXBCLE9BQ3JCeEMsRUFBRStFLFFBQ0EsU0FBQXhCLEdBTUUsT0FMQUEsRUFBSXlCLFdBQVcsTUFBTyxDQUNwQkMsT0FBTyxFQUNQQyxXQUFXLEVBQ1hsQixTQUFVVixFQUFvQmQsRUFBS2UsS0FFOUJBLEdBUFhwRCxFQUFBZ0YsUUFBQW5GLENBVUU2RSxxQ0MvTUosSUFBQU8sRUFHQUEsRUFBQSxXQUNBLE9BQUEzSCxLQURBLEdBSUEsSUFFQTJILEtBQUEsSUFBQUMsU0FBQSxpQkFDQyxNQUFBQyxHQUVELGlCQUFBQyxTQUFBSCxFQUFBRyxRQU9BbkksRUFBQUQsUUFBQWlJLGlCQ25CQWhJLEVBQUFELFFBQUFPLGlCQ0FBTixFQUFBRCxRQUFBUSxpQkNBQVAsRUFBQUQsUUFBQVMiLCJmaWxlIjoiQG5vdGFidWcvZ3VuLXN1cHByZXNzb3Itc2Vhci5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoXCJyYW1kYVwiKSwgcmVxdWlyZShcInJvdXRlLXBhcnNlclwiKSwgcmVxdWlyZShcIkBub3RhYnVnL2d1bi1zdXBwcmVzc29yXCIpKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFwiQG5vdGFidWcvZ3VuLXN1cHByZXNzb3Itc2VhclwiLCBbXCJyYW1kYVwiLCBcInJvdXRlLXBhcnNlclwiLCBcIkBub3RhYnVnL2d1bi1zdXBwcmVzc29yXCJdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIkBub3RhYnVnL2d1bi1zdXBwcmVzc29yLXNlYXJcIl0gPSBmYWN0b3J5KHJlcXVpcmUoXCJyYW1kYVwiKSwgcmVxdWlyZShcInJvdXRlLXBhcnNlclwiKSwgcmVxdWlyZShcIkBub3RhYnVnL2d1bi1zdXBwcmVzc29yXCIpKTtcblx0ZWxzZVxuXHRcdHJvb3RbXCJAbm90YWJ1Zy9ndW4tc3VwcHJlc3Nvci1zZWFyXCJdID0gZmFjdG9yeShyb290W1wicmFtZGFcIl0sIHJvb3RbXCJyb3V0ZS1wYXJzZXJcIl0sIHJvb3RbXCJAbm90YWJ1Zy9ndW4tc3VwcHJlc3NvclwiXSk7XG59KSh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDogdGhpcywgZnVuY3Rpb24oX19XRUJQQUNLX0VYVEVSTkFMX01PRFVMRV9fMl9fLCBfX1dFQlBBQ0tfRVhURVJOQUxfTU9EVUxFX18zX18sIF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzRfXykge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsIi8qIGdsb2JhbHMgUHJvbWlzZSAqL1xuaW1wb3J0ICogYXMgUiBmcm9tIFwicmFtZGFcIjtcbmltcG9ydCBSb3V0ZSBmcm9tIFwicm91dGUtcGFyc2VyXCI7XG5pbXBvcnQge1xuICBQRVJNSVNTSVZFX1NDSEVNQSBhcyBHVU5fUEVSTUlTU0lWRV9TQ0hFTUEsXG4gIGluaXRBanYgYXMgYWp2QmFzZUluaXRcbn0gZnJvbSBcIkBub3RhYnVnL2d1bi1zdXBwcmVzc29yXCI7XG5cbmNvbnN0IE1BWF9BVVRIT1JfQUxJQVNfU0laRSA9IDUxMjtcbmNvbnN0IE1BWF9BVVRIT1JfSURfU0laRSA9IDEyODsgLy8gPz8/XG5jb25zdCBhdXRob3JQYXR0ZXJuID0gXCJ+OmF1dGhvcklkXCI7XG5jb25zdCBzZWFBdXRob3JSb3V0ZSA9IG5ldyBSb3V0ZShhdXRob3JQYXR0ZXJuKTtcbmNvbnN0IHNlYVNvdWxSb3V0ZSA9IG5ldyBSb3V0ZShcIipzdHVmZn46YXV0aG9ySWQuXCIpO1xuXG5leHBvcnQgY29uc3QgQVVUSF9TQ0hFTUEgPSB7XG4gIHNlYUFsaWFzOiB7IHR5cGU6IFwic3RyaW5nXCIsIG1heExlbmd0aDogTUFYX0FVVEhPUl9BTElBU19TSVpFIH0sXG4gIFNFQUFsaWFzOiB7XG4gICAgdGl0bGU6IFwiR3VuIFNFQSBBbGlhc1wiLFxuICAgICRhc3luYzogdHJ1ZSxcbiAgICBzb3VsOiB7XG4gICAgICBwYXR0ZXJuOiBcIn5AOmFsaWFzXCIsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGFsaWFzOiB7ICRyZWY6IFwic2NoZW1hLmpzb24jL2RlZmluaXRpb25zL3NlYUFsaWFzXCIgfVxuICAgICAgfSxcbiAgICAgIHJlcXVpcmVkOiBbXCJhbGlhc1wiXVxuICAgIH0sXG4gICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IHtcbiAgICAgIGVkZ2VNYXRjaGVzS2V5OiB0cnVlLFxuICAgICAgYW55T2Y6IFt7ICRyZWY6IFwiIy9kZWZpbml0aW9ucy9TRUFBdXRob3JFZGdlXCIgfV1cbiAgICB9XG4gIH0sXG4gIHNlYUF1dGhvcklkOiB7IHR5cGU6IFwic3RyaW5nXCIsIG1heExlbmd0aDogTUFYX0FVVEhPUl9JRF9TSVpFIH0sXG4gIHNlYUF1dGhPYmo6IHtcbiAgICBvbmVPZjogW1xuICAgICAge1xuICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgZWs6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHM6IHsgdHlwZTogXCJzdHJpbmdcIiB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFwic3RyaW5nXCJcbiAgICAgIH1cbiAgICBdXG4gIH0sXG4gIFNFQUF1dGhvcjoge1xuICAgIHRpdGxlOiBcIkd1biBTRUEgQXV0aG9yXCIsXG4gICAgJGFzeW5jOiB0cnVlLFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgIHB1YjogeyAkcmVmOiBcIiMvZGVmaW5pdGlvbnMvc2VhQXV0aG9ySWRcIiB9LFxuICAgICAgZXB1YjogeyBzZWE6IHsgdHlwZTogXCJzdHJpbmdcIiB9IH0sXG4gICAgICBhbGlhczogeyBzZWE6IHsgJHJlZjogXCJzY2hlbWEuanNvbiMvZGVmaW5pdGlvbnMvc2VhQWxpYXNcIiB9IH0sXG4gICAgICBhdXRoOiB7XG4gICAgICAgIHNlYTogeyAkcmVmOiBcInNjaGVtYS5qc29uIy9kZWZpbml0aW9ucy9zZWFBdXRoT2JqXCIgfVxuICAgICAgfVxuICAgIH0sXG4gICAgYWRkaXRpb25hbFByb3BlcnRpZXM6IHtcbiAgICAgIHNlYToge1xuICAgICAgICBhbnlPZjogW1xuICAgICAgICAgIHsgJHJlZjogXCJzY2hlbWEuanNvbiMvZGVmaW5pdGlvbnMvR3VuRWRnZVwiIH0sXG4gICAgICAgICAgeyAkcmVmOiBcInNjaGVtYS5qc29uIy9kZWZpbml0aW9ucy9zZWFBdXRoT2JqXCIgfSxcbiAgICAgICAgICB7IHR5cGU6IFwibnVsbFwiIH0sXG4gICAgICAgICAgeyB0eXBlOiBcInN0cmluZ1wiIH0sXG4gICAgICAgICAgeyB0eXBlOiBcIm51bWJlclwiIH0sXG4gICAgICAgICAgeyB0eXBlOiBcImJvb2xlYW5cIiB9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9LFxuICAgIHNvdWw6IHtcbiAgICAgIHBhdHRlcm46IGF1dGhvclBhdHRlcm4sXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGF1dGhvcklkOiB7ICRyZWY6IFwic2NoZW1hLmpzb24jL2RlZmluaXRpb25zL3NlYUF1dGhvcklkXCIgfVxuICAgICAgfSxcbiAgICAgIHJlcXVpcmVkOiBbXCJhdXRob3JJZFwiXVxuICAgIH1cbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IFBFUk1JU1NJVkVfTk9ERV9TQ0hFTUEgPSB7XG4gIHRpdGxlOiBcIkd1biBTRUEgTm9kZVwiLFxuICBkZXNjcmlwdGlvbjogXCJBbnkgU0VBIG5vZGUgc3VwcG9ydGVkIGJ5IGd1blwiLFxuICAkYXN5bmM6IHRydWUsXG5cbiAgc291bDoge1xuICAgIHBhdHRlcm46IFwiKnBhdGh+OmF1dGhvcklkLlwiLFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgIHBhdGg6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgYXV0aG9ySWQ6IHsgJHJlZjogXCJzY2hlbWEuanNvbiMvZGVmaW5pdGlvbnMvc2VhQXV0aG9ySWRcIiB9XG4gICAgfSxcbiAgICByZXF1aXJlZDogW1wicGF0aFwiLCBcImF1dGhvcklkXCJdXG4gIH0sXG5cbiAgYWRkaXRpb25hbFByb3BlcnRpZXM6IHtcbiAgICBcIi4qXCI6IHtcbiAgICAgIHNlYToge1xuICAgICAgICBhbnlPZjogW1xuICAgICAgICAgIHsgJHJlZjogXCJzY2hlbWEuanNvbiMvZGVmaW5pdGlvbnMvR3VuTm9kZU1ldGFcIiB9LFxuICAgICAgICAgIHsgJHJlZjogXCJzY2hlbWEuanNvbiMvZGVmaW5pdGlvbnMvR3VuRWRnZVwiIH0sXG4gICAgICAgICAgeyB0eXBlOiBcIm51bGxcIiB9LFxuICAgICAgICAgIHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgIHsgdHlwZTogXCJudW1iZXJcIiB9LFxuICAgICAgICAgIHsgdHlwZTogXCJib29sZWFuXCIgfVxuICAgICAgICBdXG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgY29uc3QgUEVSTUlTU0lWRV9TQ0hFTUEgPSB7XG4gIC4uLkFVVEhfU0NIRU1BLFxuICBTRUFOb2RlOiBQRVJNSVNTSVZFX05PREVfU0NIRU1BLFxuICAuLi5HVU5fUEVSTUlTU0lWRV9TQ0hFTUFcbn07XG5cbmV4cG9ydCBjb25zdCByZWFkID0gKEd1biwgZGF0YSwga2V5LCBwYWlyID0gZmFsc2UpID0+IHtcbiAgY29uc3QgcGFja2VkID0gR3VuLlNFQS5vcHQucGFjayhcbiAgICBkYXRhW2tleV0sXG4gICAga2V5LFxuICAgIGRhdGEsXG4gICAgUi5wYXRoKFtcIl9cIiwgXCIjXCJdLCBkYXRhKVxuICApO1xuXG4gIHJldHVybiBHdW4uU0VBLnZlcmlmeShwYWNrZWQsIHBhaXIpLnRoZW4ociA9PiB7XG4gICAgaWYgKHR5cGVvZiByID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIHNlYSBkYXRhXCIpO1xuICAgIH1cbiAgICByZXR1cm4gR3VuLlNFQS5vcHQudW5wYWNrKHIsIGtleSwgZGF0YSk7XG4gIH0pO1xufTtcblxuY29uc3QgdmFsaWRhdGVTZWFQcm9wZXJ0eSA9IChHdW4sIGFqdikgPT4gKFxuICBzY2hlbWEsXG4gIGRhdGEsXG4gIHBTY2hlbWEsXG4gIF9jUGF0aCxcbiAgcGFyZW50RGF0YSxcbiAga2V5SW5QYXJlbnRcbikgPT4ge1xuICBjb25zdCBzb3VsID0gUi5wYXRoKFtcIl9cIiwgXCIjXCJdLCBwYXJlbnREYXRhKTtcblxuICBpZiAoa2V5SW5QYXJlbnQgPT09IFwiX1wiKSByZXR1cm4gdHJ1ZTtcbiAgY29uc3QgeyBhdXRob3JJZCB9ID1cbiAgICBzZWFTb3VsUm91dGUubWF0Y2goc291bCkgfHwgc2VhQXV0aG9yUm91dGUubWF0Y2goc291bCkgfHwge307XG5cbiAgaWYgKCFhdXRob3JJZCkgcmV0dXJuIGZhbHNlO1xuICBpZiAoc291bCA9PT0gYH4ke2F1dGhvcklkfWAgJiYga2V5SW5QYXJlbnQgPT09IFwicHViXCIpIHtcbiAgICByZXR1cm4gZGF0YSA9PT0gYXV0aG9ySWQ7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBhcyBhbiBvYmplY3QgdG8gZ2l2ZSBwcm9wZXJ0eSB2YWxpZGF0b3JzIG1vcmUgY29udGV4dFxuICBjb25zdCB2YWxpZGF0ZSA9IGFqdi5jb21waWxlKHtcbiAgICBhZGRpdGlvbmFsUHJvcGVydGllczogdHJ1ZSxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICBba2V5SW5QYXJlbnRdOiBzY2hlbWFcbiAgICB9XG4gIH0pO1xuICBsZXQgcmVzdWx0O1xuXG4gIHJldHVybiByZWFkKEd1biwgcGFyZW50RGF0YSwga2V5SW5QYXJlbnQsIGF1dGhvcklkKVxuICAgIC50aGVuKHJlcyA9PiAocmVzdWx0ID0gcmVzKSlcbiAgICAudGhlbihyZXMgPT4gUi5hc3NvYyhrZXlJblBhcmVudCwgcmVzLCBwYXJlbnREYXRhKSlcbiAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwia2V5IGVyclwiLFxuICAgICAgICBzb3VsLFxuICAgICAgICBrZXlJblBhcmVudCxcbiAgICAgICAgYXV0aG9ySWQsXG4gICAgICAgIHBhcmVudERhdGFba2V5SW5QYXJlbnRdLFxuICAgICAgICBlcnIuc3RhY2sgfHwgZXJyXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pXG4gICAgLnRoZW4ocmVzID0+IHtcbiAgICAgIGlmICghcmVzIHx8IHR5cGVvZiByZXNba2V5SW5QYXJlbnRdID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGRlbGV0ZSBwYXJlbnREYXRhW2tleUluUGFyZW50XTtcbiAgICAgICAgZGVsZXRlIChSLnBhdGgoW1wiX1wiLCBcIj5cIl0sIHBhcmVudERhdGEpIHx8IHt9KVtrZXlJblBhcmVudF07XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJzZWEgcHJvcCBlcnJcIiwgc291bCwga2V5SW5QYXJlbnQsIHJlc3VsdCwgcFNjaGVtYSk7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZhbGlkYXRlKHJlcykpLnRoZW4oaXNWYWxpZCA9PiB7XG4gICAgICAgIGlmICghaXNWYWxpZCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgICBcInNlYSB2YWxpZGF0aW9uIGVyclwiLFxuICAgICAgICAgICAgc291bCxcbiAgICAgICAgICAgIGtleUluUGFyZW50LFxuICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgdmFsaWRhdGUuZXJyb3JzLFxuICAgICAgICAgICAgcFNjaGVtYVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzVmFsaWQ7XG4gICAgICB9KTtcbiAgICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBpbml0QWp2ID0gKGNvbmYsIEd1biA9IGdsb2JhbC5HdW4pID0+XG4gIFIuY29tcG9zZShcbiAgICBhanYgPT4ge1xuICAgICAgYWp2LmFkZEtleXdvcmQoXCJzZWFcIiwge1xuICAgICAgICBhc3luYzogdHJ1ZSxcbiAgICAgICAgbW9kaWZ5aW5nOiB0cnVlLFxuICAgICAgICB2YWxpZGF0ZTogdmFsaWRhdGVTZWFQcm9wZXJ0eShHdW4sIGFqdilcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGFqdjtcbiAgICB9LFxuICAgIGFqdkJhc2VJbml0XG4gICkoY29uZik7XG4iLCJ2YXIgZztcblxuLy8gVGhpcyB3b3JrcyBpbiBub24tc3RyaWN0IG1vZGVcbmcgPSAoZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzO1xufSkoKTtcblxudHJ5IHtcblx0Ly8gVGhpcyB3b3JrcyBpZiBldmFsIGlzIGFsbG93ZWQgKHNlZSBDU1ApXG5cdGcgPSBnIHx8IG5ldyBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCk7XG59IGNhdGNoIChlKSB7XG5cdC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXG5cdGlmICh0eXBlb2Ygd2luZG93ID09PSBcIm9iamVjdFwiKSBnID0gd2luZG93O1xufVxuXG4vLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uXG4vLyBXZSByZXR1cm4gdW5kZWZpbmVkLCBpbnN0ZWFkIG9mIG5vdGhpbmcgaGVyZSwgc28gaXQnc1xuLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGc7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzJfXzsiLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzNfXzsiLCJtb2R1bGUuZXhwb3J0cyA9IF9fV0VCUEFDS19FWFRFUk5BTF9NT0RVTEVfXzRfXzsiXSwic291cmNlUm9vdCI6IiJ9